# ============================================================
# ğŸ“¦ bentofile.yaml - Configuration complÃ¨te pour BentoML
#     - Expose l'API via BentoML pour la prÃ©diction en temps rÃ©el
#     - Inclut les scripts, modÃ¨les et donnÃ©es nÃ©cessaires
#     - Configuration Docker unifiÃ©e pour dÃ©ploiement local et Cloud
# ============================================================

service: "src.service:EnergyCO2PredictionService"  # ğŸŒ Endpoint principal exposÃ© par BentoML (doit correspondre au nom exact de la classe de service)

description: "API pour la prÃ©diction en temps rÃ©el de la consommation d'Ã©nergie et des Ã©missions de COâ‚‚ des bÃ¢timents."

labels:  # ğŸ·ï¸ Informations pour suivi et gestion du projet
  owner: "user"  # ğŸ‘¤ PropriÃ©taire du projet
  project: "consommation_energie_batiments"  # ğŸ“‚ Nom du projet
  stage: "production"  # ğŸš€ Statut actuel (production, dÃ©veloppement, test, etc.)

include:  # ğŸ“‚ Fichiers nÃ©cessaires pour le bon fonctionnement de l'API
  - "src/service.py"  # ğŸŒ Logique de l'API BentoML
  - "src/config.py"   # âš™ï¸ Configuration centralisÃ©e des chemins et variables
  - "src/preprocess_data_for_models.py"  # ğŸ”„ Script de prÃ©traitement des donnÃ©es
  - "src/register_models_bentoml.py"     # ğŸ’¾ Script d'enregistrement des modÃ¨les
  - "tests/test_api.py"                 # ğŸ§ª Script de test des endpoints API (placÃ© dans un dossier tests)
  - "models/"                            # ğŸ“¦ RÃ©pertoire contenant les modÃ¨les
  - "data/processed/dataset_processed_site_energy_use.csv"  # ğŸ”‹ DonnÃ©es pour le modÃ¨le Ã©nergie
  - "data/processed/dataset_processed_ghg_emissions_total.csv"  # ğŸŒ¿ DonnÃ©es pour le modÃ¨le COâ‚‚

python:  # ğŸ ğŸ“¦ DÃ©pendances Python nÃ©cessaires (versions fixÃ©es pour cohÃ©rence)
  requirements_txt: ./requirements.txt  # ğŸ“œ Utilisation du fichier requirements.txt

# ============================================================
# ğŸ³ Docker - Configuration unifiÃ©e et corrigÃ©e pour Ã©viter les erreurs
# ============================================================
docker:
  python_version: "3.9"  # ğŸ Version Python prÃ©cisÃ©e pour Ã©viter les conflits
  base_image: "python:3.9-slim"  # ğŸ“¦ Image lÃ©gÃ¨re Python 3.9
  env:  # ğŸŒ Variables d'environnement pour la configuration dynamique
    BENTO_SERVER_PORT: 3000
    BENTO_SERVER_HOST: 0.0.0.0
  system_packages:  # ğŸ› ï¸ Paquets systÃ¨me essentiels
    - git
    - build-essential
  setup_script: |  # âš¡ Installation rapide des dÃ©pendances
    pip install --no-cache-dir -r ./requirements.txt

# ============================================================
# ğŸ—ï¸ SpÃ©cification des modÃ¨les Ã  inclure dans le package
# ============================================================
models:
  - site_energy_use_model:latest  # ğŸ”‹ ModÃ¨le pour prÃ©diction de la consommation d'Ã©nergie
  - ghg_emissions_model:latest    # ğŸŒ¿ ModÃ¨le pour prÃ©diction des Ã©missions de COâ‚‚

# ============================================================
# ğŸŒ Variables dâ€™environnement pour la gestion dynamique des chemins
# ============================================================
envs:
  - name: ENERGY_MODEL_PATH
    value: "models/site_energy_use_model"
  - name: CO2_MODEL_PATH
    value: "models/ghg_emissions_model"
  - name: PROCESSED_ENERGY_PATH
    value: "data/processed/dataset_processed_site_energy_use.csv"
  - name: PROCESSED_CO2_PATH
    value: "data/processed/dataset_processed_ghg_emissions_total.csv"

# ============================================================
# ğŸ¯ Instructions d'utilisation du bentofile.yaml
# ============================================================
# 1ï¸âƒ£ Construction du Bento :
#     â” `bentoml build`
#
# 2ï¸âƒ£ Lancement local de l'API BentoML :
#     â” `bentoml serve ./dist/energy_co2_prediction_service:latest`
#
# 3ï¸âƒ£ CrÃ©ation de l'image Docker :
#     â” `bentoml containerize energy_co2_prediction_service:latest`
#
# 4ï¸âƒ£ Lancement de l'image Docker :
#     â” `docker run -p 3000:3000 energy_co2_prediction_service:latest`
#
# ğŸŒ Swagger UI accessible via : http://127.0.0.1:3000
# ============================================================
